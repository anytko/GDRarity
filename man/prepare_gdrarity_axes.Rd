% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prepare_gdrarity_axes.r
\name{prepare_gdrarity_axes}
\alias{prepare_gdrarity_axes}
\title{Compute Rarity Dimensions Based on Selected Restrictions}
\usage{
prepare_gdrarity_axes(
  models_to_run,
  species_df,
  species_col = "species",
  abundance_df = NULL,
  phylogeny = NULL,
  geo_rarity_method = c("taxonomic", "range"),
  fun_rarity_method = c("min_distance", "mean_distance", "none"),
  trait_columns = NULL,
  min_dbscan_points = 5,
  min_dbscan_distance = 1,
  gbif_limit = 2000,
  num_cores = 1,
  site_col = "site",
  abundance_col = "abundance",
  time = FALSE,
  time_slices = NULL,
  relative = TRUE,
  abundance = TRUE,
  use_precomputed_axes = FALSE
)
}
\arguments{
\item{models_to_run}{Character vector of restrictions (e.g., \code{"GR"}, \code{"FRFL"}, \code{"GLFRPR"}, etc.) specifying which axes to compute.}

\item{species_df}{Data frame containing species-level information, including traits and optionally precomputed rarity values.}

\item{species_col}{Name of the column in \code{species_df} containing species names. Default is \code{"species"}.}

\item{abundance_df}{Optional data frame with species abundance data. Must contain \code{"species"}, \code{"site"}, and \code{"abundance"} columns.}

\item{phylogeny}{Optional \code{phylo} object for computing phylogenetic distances.}

\item{geo_rarity_method}{Method for computing regional geographic rarity. Options: \verb{"range" for range size via GBIF, or }"taxonomic"\verb{(default) to use relative occupancy via}funrar`.}

\item{fun_rarity_method}{Method for regional functional rarity calculation. Options: \code{"min_distance"} (default) to use minimum Euclidean distance, \code{"mean_distance"} to use mean Euclidean distance, or \code{"none"}.}

\item{trait_columns}{Character vector of trait column names used for functional rarity metrics.}

\item{min_dbscan_points}{Integer for DBSCAN range estimation (minimum points). Default is 5.}

\item{min_dbscan_distance}{Numeric minimum distance (in degrees) for DBSCAN range estimation. Default is 1.}

\item{gbif_limit}{Maximum number of GBIF records to download per species (if computing range size). Default is 2000.}

\item{num_cores}{Number of cores for parallel operations. Default is 1.}

\item{site_col}{Name of the column representing community or site identity in \code{abundance_df}. Default is \code{"site"}.}

\item{abundance_col}{Name of the column representing abundance values. Default is \code{"abundance"}.}

\item{time}{Logical; if \code{TRUE}, time-sliced evolutionary distinctiveness is computed. Default is \code{FALSE}.}

\item{time_slices}{Numeric vector of time slices for calculating time-sliced ED. Used only if \code{time = TRUE}.}

\item{relative}{Logical; whether to scale phylogenetic local distinctiveness (PL) values relative to maximum distance. Default is \code{TRUE}.}

\item{abundance}{Logical; whether to use abundance-weighted PL (phylogenetic local distinctiveness). Default is \code{TRUE}.
#' @param use_precomputed_axes Logical. If \code{TRUE}, the function will use rarity axes already present in \code{species_df}
for the models specified in \code{models_to_run} instead of recomputing them.
Additional, non-standard axes (e.g., \code{"H"} for habitat specificity) are always
passed through automatically if they exist in \code{species_df}, regardless of this setting.
Default is \code{FALSE}.}
}
\value{
A data frame containing species and their computed rarity dimensions, one column per axis (e.g., \code{"GR"}, \code{"FL"}, \code{"PR"}).
}
\description{
This function calculates multiple dimensions of rarity based on a set of rarity restrictions
It supports geographic, functional, and phylogenetic rarity axes across both regional and local scales, depending on the availability of trait data, abundance data, and a phylogenetic tree.
}
\details{
The function calculates the following axes when requested and data are available:
\itemize{
\item \strong{GR} – Regional Geographic Rarity (range size or restrictedness)
\item \strong{GL} – Local Geographic Rarity (from \code{funrar::scarcity_stack()})
\item \strong{FR} – Regional Functional Rarity (minimum or mean trait distance)
\item \strong{FL} – Local Functional Rarity (from \code{funrar::distinctiveness_stack()})
\item \strong{PR} – Regional Phylogenetic Rarity (evolutionary distinctiveness)
\item \strong{PL} – Local Phylogenetic Rarity (abundance-weighted or unweighted MPD)
}
User-defined custom rarity axes (e.g., \code{"H"} for habitat specificity) are also supported if present in \code{species_df}.

Uses functions from the \pkg{funrar} package. Please cite \pkg{funrar} if this function is used in published work.
}
\examples{
\dontrun{
# Example with simulated species data and traits
species_df <- data.frame(
  species = c("Abies_procera", "Alnus_incana", "Carex_distans"),
  trait1 = c(1.1, 2.3, 3.4),
 trait2 = c(4.1, 3.3, 2.2)
)

abundance_df <- data.frame(
  species = c("Abies_procera", "Alnus_incana", "Abies_procera", "Carex_distans"),
  site = c("A", "A", "B", "B"),
  presence_absence = c(1,1,1,1),
  abundance = c(5, 10, 3, 4)
)

phylo <- ape::rtree(3)
phylo$tip.label <- c("Abies_procera", "Alnus_incana", "Carex_distans")

axes <- prepare_gdrarity_axes(
  models_to_run = c("FR", "FL", "PR", "PL"),
  species_df = species_df,
  abundance_df = abundance_df,
  phylogeny = phylo,
  trait_columns = c("trait1", "trait2"),
  geo_rarity_method = "taxonomic",
  fun_rarity_method = "mean_distance"
)

head(axes)
}
}
\seealso{
\code{\link[=prepare_gdrarity_models]{prepare_gdrarity_models()}}, \code{\link[=calculate_phylo_mpd]{calculate_phylo_mpd()}}, \code{\link[funrar:scarcity_stack]{funrar::scarcity_stack()}}, \code{\link[funrar:distinctiveness_stack]{funrar::distinctiveness_stack()}}
}
