% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prepare_gdrarity_models.r
\name{prepare_gdrarity_models}
\alias{prepare_gdrarity_models}
\title{Prepare Restrictions for the Global Model of Discretized Rarity}
\usage{
prepare_gdrarity_models(
  species_df,
  abundance_df = NULL,
  phylo = NULL,
  use_internal_phylo = TRUE,
  internal_phylo_name = "ALLMB",
  trait_cols = NULL,
  species_col = "species",
  use_most_complete_model = FALSE,
  model = NULL,
  additional_dimensions = NULL
)
}
\arguments{
\item{species_df}{A data frame with at least one column identifying species (default column name is \code{"species"}).}

\item{abundance_df}{Optional data frame with abundance data. Must contain columns \code{"species"}, \code{"site"}, and \code{"abundance"} if provided.}

\item{phylo}{Optional \code{phylo} object representing a phylogenetic tree. If not provided, an internal tree can be used.}

\item{use_internal_phylo}{Logical; if \code{TRUE} (default) and no \code{phylo} is provided, the function will attempt to retrieve an internal seed plant phylogeny.}

\item{internal_phylo_name}{Character; name of the internal tree to use (e.g., \code{"ALLMB"}).}

\item{trait_cols}{Optional character vector specifying the names of trait columns in \code{species_df}.}

\item{species_col}{Character; the name of the column in \code{species_df} that contains species names (default \code{"species"}).}

\item{use_most_complete_model}{Logical; if \code{TRUE}, returns only the most complete model available.}

\item{model}{Optional character vector of specific model codes to restrict the output to. If specified, only these models are returned (if valid). Restrictions are named using rarity dimensions in the following order: geographic (G), functional (F), and phylogenetic (P) at regional (R) and local (L) scales; to run the full global model the code is GRGLFRFLPRPL.}

\item{additional_dimensions}{Optional character vector of additional column names in \code{species_df} to treat as rarity dimensions (e.g., \code{"HabitatType"}).}
}
\value{
An (invisible) list with the following components:
\describe{
\item{species_df}{The processed species data frame.}
\item{abundance_df}{The original abundance data frame if provided.}
\item{trait_cols}{The trait column names, if traits were available.}
\item{phylo}{The pruned phylogenetic tree used, or \code{NULL} if none available.}
\item{available_axes}{Character vector of available rarity axes (e.g., \code{"GR"}, \code{"FR"}).}
\item{models_to_run}{Character vector of restrictions to use based on input data.}
}
}
\description{
This function assesses available data for a given set of species and determines which rarity dimensions and corresponding restrictions can be used to analyze multidimensional rarity. It also supports automated model selection based on data completeness.
}
\details{
The function checks for availability of different rarity dimensions:
\itemize{
\item \code{"GR"}: Geographic restriction (always available if species list exists).
\item \code{"GL"}: Geographic local abundance (requires \code{abundance_df}).
\item \code{"FR"}: Functional restriction (requires trait data).
\item \code{"FL"}: Functional local abundance (requires trait and abundance data).
\item \code{"PR"}: Phylogenetic restriction (requires a phylogeny).
\item \code{"PL"}: Phylogenetic local abundance (requires a phylogeny).
}

Additional rarity dimensions can be provided. The function  constructs valid model codes (e.g., \code{"GRFR"}, \code{"GRGLFRFL"}, etc.) based on combinations
of available axes.
}
\examples{
\dontrun{
species_df <- data.frame(species = c("Abies_procera", "Alnus_incana"), trait1 = c(1.2, 3.4))
abundance_df <- data.frame(species = c("Abies_procera", "Alnus_incana"), site = c("A", "A"), abundance = c(10, 5))

setup <- prepare_gdrarity_models(
  species_df = species_df,
  abundance_df = abundance_df,
  trait_cols = "trait1",
  use_internal_phylo = TRUE,
  internal_phylo_name = "ALLMB"
)
setup$models_to_run
}

}
\seealso{
\code{\link[=get_phy_angio]{get_phy_angio()}} for retrieving internal phylogenies.
}
